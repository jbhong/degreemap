
$(document).ready(function () {
	// new posts laoder for news
	$("#load_more_news").click(function (e) {
		e.preventDefault();
		var ArticleCount = $(".tile[data-type=article]").length;
		$.post("/handlers/ajax-load-more-news.asp?blogids=38,45&skip=" + ArticleCount, function (data) {
			$(".tile[data-type=article]").last().after(data);
		});
	});




	if ($("#sorts").length > 0) {



		var urls = [];
		urls["agbe"] = "http://abe.illinois.edu/directory/";
		urls["aero"] = "http://aerospace.illinois.edu/directory/profile/";
		urls["bioe"] = "http://bioengineering.illinois.edu/directory/profile/";
		urls["cee"] = "http://cee.illinois.edu/directory/profile/";
		urls["chbe"] = "http://chbe.illinois.edu/directory/profile/";
		urls["cs"] = "http://cs.illinois.edu/directory/profile/";
		urls["ece"] = "http://www.ece.illinois.edu/directory/profile/";
		urls["ise"] = "http://ise.illinois.edu/directory/profile/jtalliso";
		urls["matse"] = "http://www.matse.illinois.edu/directory/profile/";
		urls["mechse"] = "http://mechse.illinois.edu/directory/faculty/";
		urls["npre"] = "http://npre.illinois.edu/directory/profile/";
		urls["phys"] = "http://physics.illinois.edu/people/directory/profile/";
		urls["engradm"] = "/about/directory/profile/";


		var deptUrls = [];
		deptUrls["agbe"] = "http://abe.illinois.edu/";
		deptUrls["aero"] = "http://aerospace.illinois.edu/";
		deptUrls["bioe"] = "http://bioengineering.illinois.edu/";
		deptUrls["cee"] = "http://cee.illinois.edu/";
		deptUrls["chbe"] = "http://chbe.illinois.edu/";
		deptUrls["cs"] = "http://cs.illinois.edu/";
		deptUrls["ece"] = "http://www.ece.illinois.edu/";
		deptUrls["ise"] = "http://ise.illinois.edu/jtalliso";
		deptUrls["matse"] = "http://www.matse.illinois.edu/";
		deptUrls["mechse"] = "http://mechse.illinois.edu/";
		deptUrls["npre"] = "http://npre.illinois.edu/";
		deptUrls["phys"] = "http://physics.illinois.edu/people/";
		deptUrls["engradm"] = "/about/directory/";

/*
		$(".directory-list .item.cat15").each(function (index) {
			var key = $(this).attr("data-experts-key");
			$(this).find(".name a").attr("href", "https://experts.illinois.edu/en/persons/" + key);
			$(this).find(".name a").attr("target", "_blank");
		});


		$(".directory-list .item:not(.cat15)").each(function (index) {
			var netid = $(this).attr("data-netid");
			var dept = $(this).attr("data-dept");
			if (urls[dept]) {
				$(this).find(".name a").attr("href", urls[dept] + netid);
				$(this).find(".name a").attr("target", "_blank");
			}
		});
*/


		$(".directory-list .item").each(function (index) {
			var dept = $(this).attr("data-dept");
			$(this).find(".dept a").attr("href", deptUrls[dept]);
		});

		$(".directory-list .item[data-dept='agbe']").each(function (index) {
			$(this).find(".dept a").html("ABE");
		});

		$("#faculty_expert_search_button").click(function (e) {
			e.preventDefault();
			window.location = "https://experts.illinois.edu";
		});

	}
    


	// scholarship calculator behavior
	if ($("#scholarship_calculator_controls").length > 0) {
		var costs = Array();

		$("#scholarship_calculator_graph .graph > div").each(function (i) {
			var height = $(this).parent().outerHeight();
			$(this).children("div.block").each(function (ii) {
				var key = $(this).attr("class").replace("block ", "");
				var amount = parseFloat($(this).attr("data-amount"));
				if (costs[key] == undefined) {
					costs[key] = Array();
				}
				costs[key][i] = amount;
				h = parseInt(amount / 60000 * (420 - 60));
				$(this).css("height", h + "px");
			});
		});

		ScholarshipCalculatorUpdater();

		$("#scholarship_calculator_controls input.custom-range").on("input", function (i) {
			var val = parseInt($(this).val());
			var id = $(this).attr("id");
			var $display = $("label[for='" + id + "'] span.display-value")
			$display.html(val.toLocaleString());
			ScholarshipCalculatorUpdater();
		});

		function ScholarshipCalculatorUpdater() {
			var amount = parseFloat($("#scholarship_amount").val());
			var number = parseFloat($("#scholarship_number").val());

			//costs covered table
			for (j = 0; j < 3; j++) {
				out = 100.0 * amount / parseFloat((costs["tuition"][j] + costs["fees"][j]));
				$("#schoarship_calculator_table_display #tuition-" + j).html(parseInt(out).toLocaleString() + "%");

				var totecost = 0.0;
				for (var key in costs) {
					totecost += costs[key][j];
				}
				
				out = 100.0 * amount / totecost;
				$("#schoarship_calculator_table_display #cost-" + j).html(parseInt(out).toLocaleString() + "%");
			}

			//bargraph overlay
			var barheight = amount / 60000 * 360;
			if (barheight > 420) { barheight = 420; }
			$("#scholarship_calculator_graph .graph .overlay").css("height", barheight + "px");


			//endowment amount
			out = amount * number * 25;
			$("#endowment_amount").html("$" + parseInt(out).toLocaleString());

		}
	}
	
	//webinars links
	var webinarsStoryAnchorClick = false;
	$(document).on("click", ".webinars-entry a", function (e) {
		webinarsStoryAnchorClick = true;
	});

	$(document).on("click", ".webinars-smartlink", function (e) {
		e.preventDefault();
		var href = $(this).attr("href");
		if (href.indexOf("http") == 0) {
			window.open(href, "_blank");
		}
		else {
			window.location = href;
		}
	});

	$(document).on("click", ".webinars-entry", function (e) {
		if (!webinarsStoryAnchorClick) {
			var anchor = $(this).find("a");
			var href = anchor.attr("href");
			if (href.indexOf("http") == 0) {
				window.open(href, "_blank");
			}
			else {
				window.location = href;
			}
		}
		webinarsStoryAnchorClick = false;
	});
	

	//voices department links
	if($(".voices-entry-content #voices-dept").length > 0) {		
		let depts = {
			"AE": { "url": "http://aerospace.illinois.edu", "dept": "Aerospace Engineering" },
			"ABE": { "url": "https://abe.illinois.edu", "dept": "Agricultural & Biological Engineering" },
			"BioE": { "url": "https://bioengineering.illinois.edu", "dept": "Bioengineering" },
			"ChBE": { "url": "https://chbe.illinois.edu", "dept": "Chemical and Biomolecular Engineering" },
			"CEE": { "url": "https://cee.illinois.edu", "dept": "Civil & Environmental Engineering" },
			"CS": { "url": "https://cs.illinois.edu", "dept": "Computer Science" },
			"ECE": { "url": "https://ece.illinois.edu", "dept": "Electrical & Computer Engineering" },
			"ISE": { "url": "https://ise.illinois.edu", "dept": "Industrial & Enterprise Systems Engineering" },
			"MatSE": { "url": "https://matse.illinois.edu", "dept": "Materials Science & Engineering" },
			"MechSE": { "url": "https://mechse.illinois.edu", "dept": "Mechanical Science & Engineering" },
			"NPRE": { "url": "https://npre.illinois.edu", "dept": "Nuclear, Plasma & Radiological Engineering" },
			"Physics": { "url": "https://physics.illinois.edu", "dept": "Physics" }
		}

		let dept = $(".voices-entry-content #voices-dept").text();

		$(".voices-entry-content #voices-dept").html('<a href="' + depts[dept].url + '" target="_blank"><i class="fal fa-building"></i> ' + depts[dept].dept + '</a>');
	}

	//voices links
	var voicesStoryAnchorClick = false;
	$(document).on("click", ".voices-entry a", function (e) {
		voicesStoryAnchorClick = true;
	});

	$(document).on("click", ".voices-entry", function (e) {
		if (!voicesStoryAnchorClick) {
			var anchor = $(this).find("a");
			var href = anchor.attr("href");
			if (href.indexOf("http") == 0) {
				window.open(href, "_blank");
			}
			else {
				window.location = href;
			}
		}
		voicesStoryAnchorClick = false;
	});
	
	//redirect to voices submission forms
	$("#frm_voices_submission").submit(function (event) {
        event.preventDefault();
		window.open($("#voices-submission-i-am-a").val());
    });
	
	//remove position:relative from lower class when a bootsrap modal is in the section
	$(".modal-activator").click(function (e) {
		$(this).closest(".lower").css("position", "unset");
	});
	
	//majors quiz activator
	/*$(".quiz-activator").click(function (e) {
		e.preventDefault();
		$.get("/handlers/modal-quiz.asp", function (data) {

			modalControls(data);
			$.ajax({
				type: "GET",
				url: "https://grainger.dev.engr.illinois.edu/js/quiz/quiz-questions.csv",
				dataType: "text",
				success: function(data) { quizReady(data); }
			});			
		});
	});*/
	$(".quiz-activator-1").click(function (e) {
		$(this).hide();
		$(".quiz-container").show();
	});
	
	//majors thumbnail links
	var majorThumbnailClick = false;
	$(document).on("click", ".major-thumb a", function (e) {
		majorThumbnailClick = true;
	});

	$(document).on("click", ".major-thumb", function (e) {
		if (!majorThumbnailClick) {
			var anchor = $(this).find("a");
			var href = anchor.attr("href");
			if (href.indexOf("http") == 0) {
				window.open(href, "_blank");
			}
			else {
				window.location = href;
			}
		}
		majorThumbnailClick = false;
	});
	

	/* sidebar table of content */
	var strPath = $(location).attr("pathname");
	if (strPath.substr(-1) == "/") {
		strPath = strPath.substr(0, strPath.length - 1);
	}	
	let $curTocPage = $("#toc-sidebar a[href='" + strPath + "']")
	$curTocPage.addClass("active");
	let prevTocPage = $curTocPage.parent().prev().children('a').attr('href')
	let nextTocPage = $curTocPage.parent().next().children('a').attr('href')
	if(prevTocPage != undefined) {
		$('#toc-prev').attr('href', prevTocPage);
	} else {
		$('#toc-prev').css('display', 'none');
	}
	if(nextTocPage != undefined) {
		$('#toc-next').attr('href', nextTocPage);
	} else {
		$('#toc-next').css('display', 'none');
	}

	$("#content_inner .tile-list #toc-page-wrapper .tile").each(function (i) {
		$(this).removeClass("py-6 py-5 py-4 py3 py-2 py-1").addClass("py-3");
	});

	var lastId;
	var tocItems = $("#toc-sidebar").find("a");
    var scrollItems = tocItems.map(function(){
      var item = $("#" + $(this).attr("href").split("#")[1]);
      if (item.length) { return item; }
    });
	$(window).scroll(function(){
		var fromTop = $(this).scrollTop();
		
		var cur = scrollItems.map(function(){
		  if ($(this).offset().top - 20 < fromTop)
			return this;
		});

		cur = cur[cur.length-1];
		var id = cur && cur.length ? cur[0].id : "";
		
		if (lastId !== id) {
			lastId = id;
			tocItems.removeClass("active-anchor");
			tocItems.filter("[href$='#"+id+"']").addClass("active-anchor");
		}                  
	});
	
	
	// set background for static progress circles
	$(".progress-circle").each(function() {
		var progress = $(this).find(".progress-circle-inner").attr("data-percent");
		var background = "conic-gradient(#ff552e " + progress + "%, #ffffff " + progress + "%)";
		$(this).find(".progress-circle-outer").css("background", background); 
	});

});
